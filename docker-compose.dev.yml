version: "3.8"
name: todoless-dev

services:
  todoless-frontend-dev:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: todoless-dev
    restart: unless-stopped
    ports:
      - "5174:80"
    depends_on:
      - todoless-backend-dev
    networks:
      - todoless-dev-net
    volumes:
      # Mount dist for hot reload if needed (optional)
      - ./dist:/usr/share/nginx/html

  todoless-backend-dev:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: todoless-backend-dev
    restart: unless-stopped
    environment:
      JWT_SECRET: dev-secret-change-in-production
      CORS_ORIGIN: "*"
      DB_PATH: "/app/data/todoless.db"
      COOKIE_SECURE: "false"
      NODE_ENV: development
    volumes:
      - todoless-dev-data:/app/data
      # Optional: mount source for live reload (requires nodemon/tsx watch)
      # - ./server/src:/app/src
      # - ./server/dist:/app/dist
    ports:
      - "4000:4000"
    networks:
      - todoless-dev-net
    healthcheck:
      test: ["CMD-SHELL", "wget --spider -q http://localhost:4000/api/health || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

networks:
  todoless-dev-net:
    driver: bridge

volumes:
  todoless-dev-data:
    driver: local
